import React, { useState, useEffect, useRef } from 'react';
import { db } from '../../firebaseConfig/firebase'; // Ajusta la ruta según tu estructura de proyecto
import { collection, onSnapshot } from 'firebase/firestore';

// Diccionario con coordenadas relativas de cada lote por manzana
const coordenadasLotes = {
  1:{
    1:{x: 40.32258064516129, y: 563.2000122070312},
    2:{x: 45.6989247311828, y: 541.2000122070312},
    3:{x: 55.55555555555555, y: 559.2000122070312},
    4:{x: 59.13978494623656, y: 523.2000122070312},
    5:{x: 68.99641577060932, y: 537.2000122070312},
    6:{x: 70.78853046594982, y: 495.20001220703125},
    7:{x: 80.64516129032258, y: 505.20001220703125},
    8:{x: 84.2293906810036, y: 481.20001220703125},
    9:{x: 92.29390681003584, y: 501.20001220703125},
    10:{x: 96.77419354838709, y: 465.20001220703125},
    11: {x: 105.73476702508961, y: 485.20001220703125},
    12: {x: 110.21505376344086, y: 449.20001220703125},
    13: {x: 124.55197132616487, y: 467.20001220703125},
    14: {x: 123.65591397849462, y: 431.20001220703125},
    15: {x: 131.72043010752688, y: 449.20001220703125},
    16: {x: 132.61648745519713, y: 499.20001220703125},
    17: {x: 125.44802867383511, y: 521.2000122070312},
    18: {x: 117.38351254480287, y: 517.2000122070312},
    19: {x: 112.90322580645162, y: 539.2000122070312},
    20: {x: 103.04659498207886, y: 523.2000122070312},
    21: {x: 99.46236559139784, y: 553.2000122070312},
    22: {x: 91.3978494623656, y: 545.2000122070312},
    23: {x: 86.91756272401433, y: 571.2000122070312},
    24: {x: 75.26881720430107, y: 557.2000122070312},
    25: {x: 72.58064516129033, y: 587.2000122070312},
    26: {x: 64.51612903225806, y: 571.2000122070312},
    27: {x: 59.13978494623656, y: 599.2000122070312},
    28: {x: 49.2831541218638, y: 589.2000122070312},
    29: {x: 44.80286738351254, y: 619.2000122070312}
  },
  2:{
     1: {x: 51.075268817204304, y: 685.2000122070312},
    2: {x: 59.13978494623656, y: 683.2000122070312},
    3: {x: 64.51612903225806, y: 665.2000122070312},
     4: {x: 72.58064516129033, y: 661.2000122070312},
    5: {x: 78.85304659498208, y: 649.2000122070312},
    6: {x: 85.12544802867383, y: 639.2000122070312},
 7: {x: 92.29390681003584, y: 633.2000122070312},
 8: {x: 98.5663082437276, y: 623.2000122070312},
 9: {x: 105.73476702508961, y: 617.2000122070312},
 10: {x: 112.00716845878136, y: 607.2000122070312},
 11: {x: 119.17562724014337, y: 603.2000122070312},
 12: {x: 124.55197132616487, y: 593.2000122070312},
  13: {x: 134.40860215053763, y: 583.2000122070312},
  14: {x: 133.51254480286738, y: 653.2000122070312},
  15: {x: 127.24014336917564, y: 667.2000122070312},
  16 :{x: 119.17562724014337, y: 677.2000122070312},
  17 :{x: 112.90322580645162, y: 687.2000122070312},
  18 :{x: 105.73476702508961, y: 695.2000122070312},
  19 :{x: 98.5663082437276, y: 703.2000122070312},
  20 :{x: 92.29390681003584, y: 711.2000122070312},
  21 :{x: 85.12544802867383, y: 717.2000122070312},
  22 :{x: 77.95698924731182, y: 727.2000122070312},
  23 :{x: 71.68458781362007, y: 737.2000122070312},
  24 :{x: 64.51612903225806, y: 743.2000122070312},
  25 :{x: 57.34767025089606, y: 751.2000122070312}
  },
  3:{
    1: {x: 151.43369175627242, y: 445.20001220703125}, 
 2: {x: 160.3942652329749, y: 451.20001220703125}, 
 3: {x: 166.66666666666666, y: 455.20001220703125}, 
 4: {x: 173.83512544802866, y: 455.20001220703125}, 
 5: {x: 181.00358422939067, y: 455.20001220703125}, 
 6: {x: 188.17204301075267, y: 455.20001220703125}, 
 7: {x: 196.23655913978493, y: 455.20001220703125}, 
 8: {x: 203.40501792114696, y: 461.20001220703125}, 
 9: {x: 210.57347670250894, y: 465.20001220703125}, 
 10: {x: 216.8458781362007, y: 475.20001220703125}, 
 31: {x: 224.01433691756273, y: 479.20001220703125}, 
 32: {x: 230.28673835125448, y: 481.20001220703125}, 
 13: {x: 237.4551971326165, y: 485.20001220703125}, 
 34: {x: 245.51971326164875, y: 487.20001220703125}, 
 15: {x: 242.831541218638, y: 539.2000122070312}, 
 16: {x: 234.76702508960574, y: 533.2000122070312}, 
 17: {x: 229.39068100358423, y: 525.2000122070312}, 
 18: {x: 220.43010752688173, y: 531.2000122070312}, 
 19: {x: 213.2616487455197, y: 529.2000122070312}, 
 20: {x: 206.09318996415772, y: 527.2000122070312}, 
 21: {x: 199.82078853046596, y: 527.2000122070312}, 
 22: {x: 191.7562724014337, y: 523.2000122070312}, 
 23: {x: 184.58781362007167, y: 519.2000122070312}, 
 24: {x: 176.52329749103941, y: 515.2000122070312}, 
 35: {x: 170.25089605734766, y: 511.20001220703125}, 
 26: {x: 163.9784946236559, y: 509.20001220703125}, 
 27: {x: 157.70609318996415, y: 505.20001220703125}, 
 28: {x: 150.53763440860214, y: 493.20001220703125}

  },

  4: {
     1: {x: 155.0179211469534, y: 571.2000122070312}, 
     2: {x: 154.12186379928318, y: 601.2000122070312}, 
     3: {x: 166.66666666666666, y: 601.2000122070312},
     4: {x: 173.83512544802866, y: 607.2000122070312},   
        5: {x: 181.00358422939067, y: 599.2000122070312}, 
       6: {x: 189.06810035842295, y: 595.2000122070312}, 
      7: {x: 194.44444444444446, y: 603.2000122070312}, 
      8: {x: 201.61290322580643, y: 613.2000122070312},
         9: {x: 206.98924731182797, y: 615.2000122070312}, 
        10: {x: 214.15770609318997, y: 619.2000122070312},
     11: {x: 222.2222222222222, y: 621.2000122070312},      
     12: {x: 230.28673835125448, y: 619.2000122070312},
     13: {x: 236.55913978494624, y: 631.2000122070312},
     14: {x: 233.87096774193546, y: 679.2000122070312},
     15: {x: 226.70250896057348, y: 671.2000122070312},
     16: {x: 219.53405017921145, y: 679.2000122070312},
     17: {x: 212.36559139784947, y: 679.2000122070312},
     18: {x: 205.19713261648744, y: 667.2000122070312},
     19: {x: 197.1326164874552, y: 667.2000122070312},      
     20: {x: 190.86021505376343, y: 667.2000122070312},
     21: {x: 182.7956989247312, y: 663.2000122070312},      
     22: {x: 176.52329749103941, y: 661.2000122070312},
     23: {x: 171.14695340501794, y: 659.2000122070312},
     24: {x: 163.9784946236559, y: 653.2000122070312},      
     25: {x: 155.0179211469534, y: 639.2000122070312},    
  },
  5: {
    1: { x: 262.3333282470703, y: 470.2708282470703 },
    2: { x: 272.3333282470703, y: 473.2708282470703 },
    3: { x: 279.3333282470703, y: 476.2708282470703 },
    4: { x: 280.3333282470703, y: 475.2708282470703 },
    5: { x: 290.3333282470703, y: 473.2708282470703 },
    6: { x: 301.3333282470703, y: 478.2708282470703 },
    7: { x: 308.3333282470703, y: 477.2708282470703 },
    8: { x: 317.3333282470703, y: 470.2708282470703 },
    9: { x: 326.3333282470703, y: 478.2708282470703 },
    10: { x: 334.3333282470703, y: 489.2708282470703 },
    11: { x: 333.3333282470703, y: 480.2708282470703 },
    12: { x: 342.3333282470703, y: 480.2708282470703 },
    13: { x: 344.3333282470703, y: 540.2708282470703 },
    14: { x: 335.3333282470703, y: 540.2708282470703 },
    15: { x: 336.3333282470703, y: 540.2708282470703 },
    16: {  x: 328.3333282470703, y: 540.2708282470703 },
    17: { x: 319.3333282470703, y: 540.2708282470703 },
    18: { x: 309.3333282470703, y: 540.2708282470703 },
    19: { x: 300.3333282470703, y: 540.2708282470703 },
    20: { x: 292.3333282470703, y: 540.2708282470703 },
    21: { x: 285.3333282470703, y: 540.2708282470703 },
    22: { x: 284.3333282470703, y: 560.2708282470703 },
    23: { x: 275.3333282470703, y: 540.2708282470703 },
    24: { x: 268.3333282470703, y: 540.2708282470703 },
    25: { x: 260.3333282470703, y: 540.2708282470703 },
    // Agrega más lotes aquí
  },
  6: {
    1: { x: 252, y: 640 },
    2: { x: 262, y: 640 },
    3: { x: 272, y: 640 },
    4: { x: 272, y: 640 },
    5: { x: 285, y: 640 },
    6: { x: 295, y: 640 },
    7: { x: 302, y: 640 },
    8: { x: 312, y: 640 },
    9: { x: 317, y: 640 },
    10: { x: 325, y: 630 },
    11: { x: 330, y: 630 },
    12: { x: 335, y: 620 },
    13: { x: 342, y: 620 },
    14: { x: 345, y: 660 },
    15: { x: 342, y: 670 },
    16: { x: 335, y: 675 },
    17: { x: 325, y: 675 },
    18: { x: 320, y: 675 },
    19: { x: 310, y: 675 },
    20: { x: 305, y: 670 },
    21: { x: 298, y: 680 },
    22: { x: 290, y: 680 },
    23: { x: 285, y: 685 },
    24: { x: 280, y: 685 },
    25: { x: 270, y: 685 },
    26: { x: 260, y: 685 },
    27: { x: 255, y: 685 },
    // Agrega más lotes aquí
  },
  7: {
    1: { x: 362.3333282470703, y: 450.2708282470703 },
    2: { x: 362, y: 450 },
    3: { x: 372, y: 450 },
    4: { x: 378, y: 450 },
    5: { x: 385, y: 450 },
    6: { x: 395, y: 450 },
    7: { x: 399, y: 450 },
    8: { x: 402, y: 450 },
    9: { x: 412, y: 450 },
    10: { x: 420, y: 450 },
    11: { x: 425, y: 450 },
    
    14: { x: 440, y: 540 },
    15: { x: 432, y: 540 },
    16: { x: 425, y: 545 },
    17: { x: 415, y: 545 },
    18: { x: 410, y: 545 },
    19: { x: 410, y: 545 },
    20: { x: 405, y: 540 },
    21: { x: 398, y: 540 },
    22: { x: 385, y: 540 },
    23: { x: 380, y: 545 },
    24: { x: 370, y: 545 },
    25: { x: 360, y: 545 },
    // Agrega más lotes aquí
  },
  8:{
  1: {x: 362.00716845878134, y: 617.2000122070312},
  2: {x: 370.9677419354839, y: 619.2000122070312},   
  3: {x: 376.34408602150535, y: 613.2000122070312},
  4: {x: 383.5125448028674, y: 617.2000122070312},   
  5: {x: 391.57706093189967, y: 611.2000122070312},
  6: {x: 398.7455197132617, y: 597.2000122070312},   
  7: {x: 405.9139784946236, y: 597.2000122070312},   
  8: {x: 413.0824372759856, y: 613.2000122070312}, 
  9: {x: 419.35483870967744, y: 605.2000122070312},
  10: {x: 428.31541218637994, y: 609.2000122070312},
  11: {x: 436.37992831541214, y: 609.2000122070312},
  12: {x: 442.65232974910396, y: 611.2000122070312},
  13: {x: 448.9247311827957, y: 597.2000122070312},
  14: {x: 449.82078853046596, y: 611.2000122070312},
  15: {x: 450.7168458781362, y: 653.2000122070312},
  16: {x: 443.5483870967742, y: 663.2000122070312},
  17: {x: 435.48387096774195, y: 663.2000122070312},
  18: {x: 429.2114695340502, y: 671.2000122070312},
  19: {x: 422.0430107526882, y: 669.2000122070312},
  20: {x: 413.0824372759856, y: 673.2000122070312},
  21: {x: 406.8100358422939, y: 671.2000122070312},
  22: {x: 399.6415770609319, y: 677.2000122070312},
  23: {x: 391.57706093189967, y: 669.2000122070312},
  24: {x: 385.30465949820785, y: 679.2000122070312},
  25: {x: 378.1362007168459, y: 679.2000122070312},
  26: {x: 370.07168458781365, y: 683.2000122070312},
  27: {x: 363.79928315412184, y: 675.2000122070312}
  },
  9: {
    1: {x: 491.00782932379303, y: 440.8666687011719}, 
    2: {x: 500.6232139391776, y: 434.8666687011719}, 
    3: {x: 507.03347034943414, y: 416.8666687011719}, 
    4: {x: 514.5121028280665, y: 396.8666687011719}, 
    5: {x: 519.8539831699469, y: 374.8666687011719}, 
    6: {x: 523.0591113750751, y: 356.8666687011719}, 
    7: {x: 526.2642395802033, y: 332.8666687011719}, 
    8: {x: 529.4693677853315, y: 312.8666687011719}, 
    9: {x: 534.8112481272119, y: 298.8666687011719}, 
    10: {x: 540.1531284690923, y: 277.5333251953125}, 
    11: {x: 545.4950088109725, y: 263.5333251953125},
    12: {x: 548.7001370161007, y: 322.6333312988281}, 
    13: {x: 559.3838976998614, y: 338.6333312988281}, 
    12: {x: 548.7001370161007, y: 372.6333312988281}, 
    15: {x: 546.5633848793486, y: 393.6333312988281}, 
    16: {x: 546.5633848793486, y: 412.6333312988281}, 
    17: {x: 544.4266327425966, y: 434.6333312988281}, 
    18: {x: 543.3582566742205, y: 459.6333312988281}, 
    19: {x: 534.8112481272119, y: 473.6333312988281}, 
    20: {x: 527.3326156485793, y: 475.6333312988281}, 
    21: {x: 520.922359238323, y: 479.6333312988281}, 
    22: {x: 512.3753506913145, y: 479.6333312988281}, 
    23: {x: 508.1018464178102, y: 495.6333312988281}, 
    24: {x: 498.48646180242554, y: 481.6333312988281}, 
    25: {x: 493.14458146054517, y: 501.6333312988281}
  },
  10:{
 1: {x: 495.28133359729736, y: 580.6333312988281}, 
 2: {x: 503.82834214430596, y: 585.6333312988281}, 
 3: {x: 511.3069746229384, y: 561.6333312988281}, 
 4: {x: 515.5804788964426, y: 549.6333312988281}, 
 5: {x: 523.0591113750751, y: 545.6333312988281}, 
 6: {x: 529.4693677853315, y: 535.6333312988281}, 
 7: {x: 536.9480002639641, y: 537.6333312988281}, 
 8: {x: 543.3582566742205, y: 525.6333312988281}, 
 9: {x: 551.905265221229, y: 521.6333312988281}, 
 10: {x: 559.3838976998614, y: 599.6333312988281}, 
 11: {x: 550.8368891528529, y: 595.6333312988281}, 
 12: {x: 546.5633848793486, y: 607.6333312988281}, 
 13: {x: 536.9480002639641, y: 609.6333312988281}, 
 14: {x: 532.6744959904597, y: 619.6333312988281}, 
 15: {x: 524.1274874434512, y: 627.6333312988281}, 
 16: {x: 516.6488549648187, y: 629.6333312988281}, 
 17: {x: 511.3069746229384, y: 639.6333312988281}, 
 18: {x: 502.75996607592987, y: 637.6333312988281},
 19: {x: 495.28133359729736, y: 657.6333312988281}
  },
  11:{
 1: {x: 566.862530178494, y: 522.7999877929688}, 
 2: {x: 571.1360344519983, y: 504.79998779296875}, 
 3: {x: 578.6146669306307, y: 502.79998779296875}, 
 4: {x: 586.0932994092632, y: 492.79998779296875}, 
 5: {x: 593.5719318878956, y: 482.79998779296875}, 
 6: {x: 599.9821882981521, y: 470.79998779296875}, 
 7: {x: 606.3924447084084, y: 472.79998779296875}, 
 8: {x: 613.8710771870409, y: 466.79998779296875}, 
 9: {x: 619.2129575289213, y: 454.79998779296875}, 
 10: {x: 626.6915900075537, y: 448.79998779296875},
 11: {x: 636.3069746229384, y: 500.79998779296875},
 12: {x: 641.6488549648187, y: 522.7999877929688}, 
 13: {x: 627.7599660759299, y: 518.7999877929688}, 
 14: {x: 621.3497096656733, y: 534.7999877929688}, 
 15: {x: 612.8027011186649, y: 540.7999877929688}, 
 16: {x: 606.3924447084084, y: 552.7999877929688}, 
 17: {x: 601.0505643665282, y: 560.7999877929688}, 
 18: {x: 593.5719318878956, y: 562.7999877929688},
 19: {x: 585.0249233408871, y: 564.7999877929688}, 
 20: {x: 578.6146669306307, y: 572.7999877929688},
 21: {x: 570.0676583836222, y: 574.7999877929688}
  },
  12: {
    1: {x: 565.7941541101179, y: 437.79998779296875}, 
    2: {x: 570.0676583836222, y: 408.79998779296875}, 
   3: {x: 573.2727865887504, y: 384.79998779296875}, 
   4: {x: 575.4095387255024, y: 364.79998779296875}, 
  5: {x: 576.4779147938785, y: 330.79998779296875},
  6: {x: 586.0932994092632, y: 330.79998779296875},
  7: {x: 599.9821882981521, y: 340.79998779296875},
  8: {x: 601.0505643665282, y: 363.6333312988281}, 
  9: {x: 605.3240686400325, y: 383.6333312988281}, 
 10: {x: 608.5291968451606, y: 405.6333312988281}, 
 11: {x: 594.6403079562716, y: 417.6333312988281}, 
 12: {x: 587.1616754776392, y: 419.6333312988281}, 
 13: {x: 577.5462908622546, y: 423.6333312988281}
  },
  13:{
  1: {x: 558.3155216314854, y: 230.29998779296875}, 
 2: {x: 568.9992823152461, y: 212.29998779296875}, 
 3: {x: 574.3411626571265, y: 202.29998779296875}, 
 4: {x: 581.8197951357589, y: 194.29998779296875}, 
 5: {x: 586.0932994092632, y: 180.29998779296875}, 
 6: {x: 595.7086840246477, y: 170.29998779296875}, 
 7: {x: 599.9821882981521, y: 188.29998779296875}, 
 8: {x: 599.9821882981521, y: 222.29998779296875}, 
 9: {x: 595.7086840246477, y: 248.29998779296875}, 
 10: {x: 590.3668036827673, y: 274.29998779296875}, 
 11: {x: 581.8197951357589, y: 276.29998779296875}, 
 12: {x: 573.2727865887504, y: 278.29998779296875}, 
 13: {x: 565.7941541101179, y: 274.29998779296875}, 
 14: {x: 562.5890259049896, y: 252.29998779296875}
  },
  14:{
    1: {x: 630.9650942810581, y: 372.29998779296875}, 
    2: {x: 626.6915900075537, y: 344.29998779296875}, 
    3: {x: 619.2129575289213, y: 330.29998779296875}, 
    4: {x: 609.5975729135366, y: 296.29998779296875}, 
    5: {x: 618.1445814605452, y: 276.29998779296875}, 
    6: {x: 620.2813335972974, y: 252.29998779296875}, 
    7: {x: 634.1702224861863, y: 266.29998779296875}, 
    8: {x: 641.6488549648187, y: 276.29998779296875}, 
    9: {x: 652.3326156485793, y: 274.29998779296875}, 
    10: {x: 666.2215045374683, y: 280.29998779296875}, 
    11: {x: 654.4693677853315, y: 302.29998779296875}, 
    12: {x: 648.0591113750751, y: 318.29998779296875}, 
    13: {x: 640.5804788964426, y: 340.29998779296875}
  },
  15:{
   1: {x: 617.0762053921691, y: 143.29998779296875},
 2: {x: 621.3497096656733, y: 163.29998779296875}, 
 3: {x: 620.2813335972974, y: 187.29998779296875}, 
 4: {x: 628.8283421443059, y: 181.29998779296875}, 
 5: {x: 640.5804788964426, y: 181.29998779296875}, 
 6: {x: 650.1958635118273, y: 167.29998779296875}, 
 7: {x: 659.8112481272119, y: 145.29998779296875}, 
 8: {x: 665.1531284690923, y: 155.29998779296875}, 
 9: {x: 673.7001370161007, y: 171.29998779296875}, 
 10: {x: 682.2471455631093, y: 185.29998779296875}, 
 11: {x: 693.9992823152461, y: 191.29998779296875}, 
 12: {x: 699.3411626571265, y: 171.29998779296875}, 
 13: {x: 698.2727865887504, y: 230.29998779296875}, 
 14: {x: 691.862530178494, y: 244.29998779296875}, 
 15:{x: 684.3838976998614, y: 228.29998779296875}, 
 16:{x: 674.7685130844768, y: 240.29998779296875}, 
 17:{x: 668.3582566742205, y: 224.29998779296875}, 
 18:{x: 660.879624195588, y: 236.29998779296875}, 
 19:{x: 655.5377438537075, y: 216.29998779296875}, 
 20:{x: 645.922359238323, y: 228.29998779296875}, 
 21:{x: 640.5804788964426, y: 216.29998779296875}, 
 22: {x: 622.4180857340494, y: 210.29998779296875}
  },

16:{
    1: {x: 638.4437267596905, y: 424.79998779296875}, 
 2: {x: 648.0591113750751, y: 430.79998779296875}, 
 3: {x: 652.3326156485793, y: 400.79998779296875}, 
 4: {x: 658.7428720588357, y: 390.79998779296875}, 
 5: {x: 661.9480002639641, y: 374.79998779296875}, 
 6: {x: 665.1531284690923, y: 350.79998779296875}, 
 7: {x: 675.8368891528529, y: 348.79998779296875}, 
 8: {x: 676.905265221229, y: 330.79998779296875}, 
 9: {x: 684.3838976998614, y: 320.79998779296875}, 
 10: {x: 699.3411626571265, y: 296.79998779296875}, 
 11: {x: 698.2727865887504, y: 334.79998779296875}, 
 12: {x: 699.3411626571265, y: 358.79998779296875}, 
 13: {x: 695.0676583836222, y: 374.79998779296875}, 
 14: {x: 690.7941541101179, y: 402.79998779296875}, 
 15: {x: 687.5890259049896, y: 422.79998779296875}, 
 16: {x: 681.1787694947332, y: 432.79998779296875}, 
 17: {x: 675.8368891528529, y: 444.79998779296875}, 
 18: {x: 667.2898806058444, y: 448.79998779296875}, 
 19: {x: 663.0163763323401, y: 470.79998779296875}, 
 20: {x: 655.5377438537075, y: 486.79998779296875}
  },
  17:{
  3: {x: 733.5291968451606, y: 169.79998779296875}, 
 4: {x: 737.8027011186649, y: 177.79998779296875}, 
 5: {x: 746.3497096656733, y: 171.79998779296875}, 
 6: {x: 753.8283421443059, y: 180.29998779296875}, 
 7: {x: 762.3753506913145, y: 177.29998779296875}, 
 8: {x: 771.9907353066991, y: 168.29998779296875}, 
  17: {x: 774.1274874434512, y: 245.29998779296875}, 
  18: {x: 766.6488549648187, y: 245.29998779296875}, 
  19: {x: 761.3069746229384, y: 233.29998779296875}, 
  20: {x: 753.8283421443059, y: 242.29998779296875}, 
  21: {x: 746.3497096656733, y: 247.29998779296875}, 
  22: {x: 738.8710771870409, y: 235.29998779296875}, 
 23: {x: 732.4608207767845, y: 241.29998779296875}
  },
  18:{
    3: {x: 731.3924447084084, y: 319.29998779296875}, 
    4: {x: 737.8027011186649, y: 329.29998779296875}, 
    5: {x: 746.3497096656733, y: 319.29998779296875}, 
    6: {x: 760.2385985545624, y: 315.29998779296875}, 
    7: {x: 765.5804788964426, y: 313.29998779296875}, 
    13: {x: 790.1531284690923, y: 381.29998779296875}, 
     14: {x: 781.6061199220836, y: 381.29998779296875}, 
     15: {x: 774.1274874434512, y: 387.29998779296875}, 
     16: {x: 767.7172310331948, y: 391.29998779296875}, 
     17: {x: 760.2385985545624, y: 393.29998779296875}, 
     18: {x: 752.7599660759299, y: 382.29998779296875}, 
     19: {x: 746.3497096656733, y: 387.29998779296875}, 
     20: {x: 738.8710771870409, y: 381.29998779296875}, 
    21: {x: 731.3924447084084, y: 396.29998779296875}
     },
     19:{
       1: {x: 816.862530178494, y: 191.29998779296875}, 
       2: {x: 823.2727865887504, y: 207.29998779296875}, 
       3: {x: 832.8881712041349, y: 181.29998779296875}, 
       4: {x: 838.2300515460153, y: 197.29998779296875}, 
       5: {x: 842.5035558195195, y: 209.29998779296875}, 
       6: {x: 849.9821882981521, y: 221.29998779296875}, 
       7: {x: 859.5975729135366, y: 218.29998779296875}, 
       8: {x: 862.8027011186649, y: 233.29998779296875}, 
       9: {x: 867.0762053921691, y: 247.29998779296875}, 
      10: {x: 872.4180857340494, y: 261.29998779296875}, 
      11: {x: 877.7599660759299, y: 273.29998779296875},
      12: {x: 885.2385985545624, y: 287.29998779296875},
      13: {x: 891.6488549648187, y: 297.29998779296875},
      14: {x: 899.1274874434512, y: 301.29998779296875},
      15: {x: 902.3326156485793, y: 313.29998779296875},
      16: {x: 893.7856071015708, y: 351.29998779296875},
      17: {x: 885.2385985545624, y: 337.29998779296875},
      18: {x: 878.8283421443059, y: 339.29998779296875},
      19: {x: 873.4864618024255, y: 322.29998779296875},
      20: {x: 866.0078293237931, y: 327.29998779296875}, 
      21: {x: 861.7343250502888, y: 309.29998779296875}, 
      22: {x: 852.1189404349042, y: 313.29998779296875}, 
      23: {x: 848.913812229776, y: 299.29998779296875}, 
      24: {x: 839.2984276143914, y: 297.29998779296875}, 
      25: {x: 833.956547272511, y: 279.29998779296875}, 
      26: {x: 828.6146669306307, y: 275.29998779296875}, 
      27: {x: 822.2044105203743, y: 265.29998779296875}, 
      28: {x: 813.6574019733657, y: 255.29998779296875}
      
     },
     20:{
       1: {x: 808.3155216314854, y: 329.29998779296875}, 
  2: {x: 816.862530178494, y: 342.29998779296875}, 
  3: {x: 822.2044105203743, y: 357.29998779296875}, 
  4: {x: 828.6146669306307, y: 369.29998779296875}, 
  5: {x: 835.0249233408871, y: 379.29998779296875}, 
  6: {x: 843.5719318878956, y: 377.29998779296875}, 
  7: {x: 852.1189404349042, y: 379.29998779296875}, 
  8: {x: 856.3924447084084, y: 399.29998779296875}, 
  9: {x: 862.8027011186649, y: 385.29998779296875}, 
 10: {x: 866.0078293237931, y: 409.29998779296875}, 
 11: {x: 872.4180857340494, y: 424.29998779296875}, 
 12: {x: 880.9650942810581, y: 425.29998779296875}, 
 13: {x: 875.6232139391776, y: 467.29998779296875}, 
 14: {x: 867.0762053921691, y: 478.29998779296875}, 
 15: {x: 858.5291968451606, y: 464.29998779296875}, 
 16: {x: 855.3240686400325, y: 452.29998779296875}, 
 17: {x: 846.7770600930239, y: 456.29998779296875}, 
 18: {x: 840.3668036827673, y: 442.29998779296875}, 
 19: {x: 837.1616754776392, y: 434.29998779296875}, 
 20: {x: 827.5462908622546, y: 428.29998779296875}, 
 21: {x: 822.2044105203743, y: 416.29998779296875}, 
 22: {x: 815.7941541101179, y: 407.29998779296875}, 
 23: {x: 809.3838976998614, y: 411.29998779296875}, 
 24: {x: 804.0420173579811, y: 397.29998779296875}
     },

     21:{
      1: {x: 919.4266327425966, y: 331.29998779296875}, 
 2: {x: 922.6317609477247, y: 351.29998779296875},
 3: {x: 933.3155216314854, y: 353.29998779296875},
 4: {x: 936.5206498366135, y: 371.29998779296875},
 5: {x: 940.7941541101179, y: 385.29998779296875},
 6: {x: 947.2044105203743, y: 403.29998779296875},
 7: {x: 952.5462908622546, y: 415.29998779296875},
 8: {x: 964.2984276143914, y: 423.29998779296875},
 9: {x: 965.3668036827673, y: 458.29998779296875},
 10: {x: 961.0932994092632, y: 490.29998779296875}, 
 11: {x: 947.2044105203743, y: 485.29998779296875}, 
 12: {x: 938.6574019733657, y: 462.29998779296875}, 
 13: {x: 935.4522737682374, y: 444.29998779296875}, 
 14: {x: 931.1787694947332, y: 432.29998779296875}, 
 15: {x: 923.7001370161007, y: 416.29998779296875}, 
 16: {x: 917.2898806058444, y: 403.29998779296875}, 
 17: {x: 910.879624195588, y: 383.29998779296875} 
     },

     22:{
       1: {x: 898.0591113750751, y: 456.29998779296875}, 
       2: {x: 905.5377438537075, y: 474.29998779296875}, 
       3: {x: 913.0163763323401, y: 488.29998779296875}, 
      4: {x: 918.3582566742205, y: 498.29998779296875}, 
      5: {x: 922.6317609477247, y: 514.2999877929688}, 
      6: {x: 931.1787694947332, y: 522.2999877929688}, 
      7: {x: 936.5206498366135, y: 536.2999877929688}, 
      8: {x: 939.7257780417417, y: 550.2999877929688}, 
      9: {x: 945.0676583836222, y: 562.2999877929688}, 
      10: {x: 950.4095387255024, y: 584.2999877929688}, 
      11: {x: 958.956547272511, y: 590.2999877929688}, 
      12: {x: 961.0932994092632, y: 626.2999877929688}, 
      13: {x: 958.956547272511, y: 650.2999877929688}, 
      14: {x: 947.2044105203743, y: 632.2999877929688}, 
      15: {x: 941.862530178494, y: 618.2999877929688}, 
      16: {x: 937.5890259049896, y: 608.2999877929688}, 
      17: {x: 929.0420173579811, y: 598.2999877929688}, 
      18: {x: 922.6317609477247, y: 592.2999877929688}, 
      19: {x: 917.2898806058444, y: 576.2999877929688}, 
      20: {x: 910.879624195588, y: 562.2999877929688}, 
      21: {x: 905.5377438537075, y: 548.2999877929688}, 
      22: {x: 901.2642395802033, y: 534.2999877929688}, 
      23: {x: 894.8539831699469, y: 522.2999877929688}, 
      24: {x: 888.4437267596905, y: 500.2999877929688}
     }
  // Agrega más manzanas aquí
};

export const MapaSeguridad2 = () => {
  const [unidades, setUnidades] = useState([ ]);
  const [selected, setSelected] = useState({ manzana: '', lote: '' });
  const canvasRef = useRef(null);
  const containerRef = useRef(null);

  useEffect(() => {
    const unsubscribe = onSnapshot(collection(db, 'mensajes'), (snapshot) => {
      snapshot.docChanges().forEach((change) => {
        if (change.type === 'added') {
          const newMessage = change.doc.data();
          const updatedUnidades = unidades.map((unidad) =>
            unidad.manzana === newMessage.manzana && unidad.lote === newMessage.lote
              ? { ...unidad, position: coordenadasLotes[newMessage.manzana]?.[newMessage.lote] || unidad.position }
              : unidad
          );
          setUnidades(updatedUnidades);
        }
      });
    });

    return () => unsubscribe();
  }, [unidades]);

  useEffect(() => {
    const canvas = canvasRef.current;
    const ctx = canvas.getContext('2d');

    const drawMap = () => {
      const img = new Image();
      img.src = '/img/planoIslas.png'; // Ruta de la imagen
      img.onload = () => {
        canvas.width = containerRef.current.offsetWidth;
        canvas.height = containerRef.current.offsetHeight;
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

        unidades.forEach((unidad) => {
          const x = (unidad.position.x / 1000) * canvas.width;
          const y = (unidad.position.y / 1000) * canvas.height;
          ctx.beginPath();
          ctx.arc(x, y, 5, 0, 2 * Math.PI);
          ctx.fillStyle = 'red';
          ctx.fill();
          ctx.stroke();

          ctx.font = '12px Arial';
          ctx.fillStyle = 'black';
          ctx.fillText(`Manzana ${unidad.manzana} Lote ${unidad.lote}`, x + 12, y);
        });
      };
    };

    const handleClick = (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left; // Coordenada X relativa al canvas
        const y = e.clientY - rect.top;  // Coordenada Y relativa al canvas
        console.log(`Coordenadas del clic - x: ${x}, y: ${y}`);
        alert(`Coordenadas del clic - x: ${x}, y: ${y}`);
      };
    
      canvas.addEventListener('click', handleClick);
    
      drawMap();
      window.addEventListener('resize', drawMap);
      return () => {
        window.removeEventListener('resize', drawMap);
        canvas.removeEventListener('click', handleClick);
      };
    }, [unidades]);

  const handleMark = () => {
    const { manzana, lote } = selected;
    const nuevaPosicion = coordenadasLotes[Number(manzana)]?.[Number(lote)];

    if (nuevaPosicion) {
      setUnidades([...unidades, { id: unidades.length + 1, manzana: Number(manzana), lote: Number(lote), position: nuevaPosicion }]);
    } else {
      alert('Coordenadas no definidas para esta manzana y lote.');
    }
  };

  return (
    <div ref={containerRef} style={{ position: 'relative', width: '100%', height: '500px' }}>
      <h2>Mapa de Unidades Funcionales</h2>
      <canvas ref={canvasRef} style={{ width: '100%', height: '100%' }} />
      <div style={{ marginTop: '10px' }}>
        <input
          type="number"
          placeholder="Manzana"
          value={selected.manzana}
          onChange={(e) => setSelected({ ...selected, manzana: e.target.value })}
        />
        <input
          type="number"
          placeholder="Lote"
          value={selected.lote}
          onChange={(e) => setSelected({ ...selected, lote: e.target.value })}
        />
        <button onClick={handleMark}>Marcar</button>
      </div>
    </div>
  );
};
